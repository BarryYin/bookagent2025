<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <title>简单测试</title>
</head>

<body>
    <h1>表单测试</h1>
    <form id="initial-form">
        <input type="text" id="initial-input" placeholder="输入书名" required>
        <button type="submit">生成</button>
    </form>

    <div id="output"></div>

    <script>
        console.log('脚本开始执行');

        document.addEventListener('DOMContentLoaded', () => {
            console.log('DOM加载完成');

            const form = document.getElementById('initial-form');
            const input = document.getElementById('initial-input');
            const output = document.getElementById('output');

            console.log('表单元素:', form);
            console.log('输入元素:', input);

            if (form) {
                form.addEventListener('submit', function (e) {
                    console.log('表单提交事件触发');
                    e.preventDefault();
                    console.log('preventDefault已调用');

                    const value = input.value.trim();
                    console.log('输入值:', value);

                    output.innerHTML = `<p>输入的书名: ${value}</p><p>时间: ${new Date().toLocaleString()}</p>`;

                    // 测试API调用
                    console.log('开始API测试');
                    fetch('/generate', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ topic: value, history: [] })
                    })
                        .then(response => {
                            console.log('API响应:', response.status);
                            output.innerHTML += `<p>API状态: ${response.status}</p>`;
                            return response.text();
                        })
                        .then(data => {
                            console.log('API数据长度:', data.length);
                            output.innerHTML += `<p>API响应长度: ${data.length} 字符</p>`;
                        })
                        .catch(error => {
                            console.error('API错误:', error);
                            output.innerHTML += `<p style="color: red;">API错误: ${error.message}</p>`;
                        });
                });
                console.log('事件监听器已添加');
            } else {
                console.error('找不到表单元素');
            }
        });
    </script>
</body>

</html>